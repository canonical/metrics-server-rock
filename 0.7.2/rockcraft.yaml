name: metrics-server
summary: ROCK for the metrics-server Project.
description: >
  Metrics Server is a scalable, efficient source of container resource metrics
  for Kubernetes built-in autoscaling pipelines.
version: "0.7.2"
license: Apache-2.0

base: bare
build-base: ubuntu@22.04
platforms:
  amd64:
  arm64:

services:
  metrics-server:
    override: replace
    summary: "metrics-server service"
    startup: enabled
    command: "/metrics-server [ ]"
    on-failure: shutdown

entrypoint-service: metrics-server

parts:
  metrics-server:
    plugin: nil
    source: https://github.com/kubernetes-sigs/metrics-server.git
    source-type: git
    source-tag: v0.7.2
    source-depth: 1
    build-packages:
      - build-essential
    build-snaps:
      - go/1.22-fips/stable
    override-build: |
      go version
      CGO_ENABLED=1 make SYSTEM="GOTOOLCHAIN=local GOEXPERIMENT=opensslcrypto" ARCH=${CRAFT_TARGET_ARCH}
      cp $CRAFT_PART_BUILD/metrics-server $CRAFT_PART_INSTALL
